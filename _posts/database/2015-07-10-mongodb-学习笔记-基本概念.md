---
layout: post
title: MongoDB学习笔记-基本概念
category: database
tags: [MongoDB , database, linux]
description: MongoDB入门基本概念。
---

## MongoDB
[MongoDB][1] 是一个开源的文档数据库，旨在为应用提供高性能，高可用性，易扩展的解决方案。

## MongoDB基本概念

- 文档是MongoDB 中数据的基本单元，非常类似于关系型数据库管理系统中的行，
但更具表现力。

- 集合（collection）可以看作是一个拥有动态模式（dynamic schema）的表。

- MongoDB 的一个实例可以拥有多个相互独立的数据库（database），每一个数据库都拥有自己的集合。

- 每一个文档都有一个特殊的键"_id"， 这个键在文档所属的集合中是唯一的。

- MongoDB 自带了一个简单但功能强大的JavaScript shell，可用于管理MongoDB
的实例或数据操作。

### 基本概念详解

- 文档

> 文档是MongoDB 的核心概念。文档就是键值对的一个有序集。例如，在JavaScript 里面，文档被表示为对象{}。以下是一个只有一个键"msg"，其对应的值为"Hello，liguoyi!"的文档{"msg" : "Hello,liguoyi!"}。实际应用中，文档可能比这个复杂得多，包含多个键值对，多种数据类型，文档中内嵌文档等。

> 文档中的键是除以下少数情况外的任意UTF8字符串。

> + 键不能含有\0（空字符）。这个字符用于表示键的结尾。
> + . 和$ 具有特殊意义，只能在特定环境下使用。通常，这两个字符是被保留的；如果使用不当的话，驱动程序会有提示。

> MongoDB文档不但区分类型，而且区分大小写

> + {"datatype":1} 和 {"datatype":"1"}是不同的文档
> + {"datatype":1} 和 {"DataType":1} 是不同文档

> MongoDB文档不能有重复的键

> + {"dt":1,"dt":2}是非法文档

> MongoDB文档中的键/ 值对是有序的

> + {"a":1,"b":2} 和 {"b":2,"a":1}是不同文档

- 集合

> 集合就是一组文档。如果将MongoDB中的一个文档比喻为关系型数据库中的一行，那么一个集合就相当于一张表。

> 集合是动态模式的。这意味着一个集合里面的文档可以是各式各样的。

> + 例如:两个键不同，值类型不同的集合{"dt":1} 和 {"msg":"hello"}可以放在同一个文档中。

> 既然没有必要区分不同类型文档的模式，为什么还要使用多个集合呢？这里有几个重要的原因。

> + 如果把各种各样的文档不加区分地放在同一个集合里，无论对开发者还是对管理
员来说都将是噩梦。开发者要么确保每次查询只返回特定类型的文档，要么让执
行查询的应用程序来处理所有不同类型的文档。如果查询博客文章时还要剔除含
有作者数据的文档，这会带来很大困扰。

> + 在一个集合里查询特定类型的文档在速度上也很不划算，分开查询多个集合要快得多。例如，假设集合里面一个名为"type" 的字段用于指明文档是skim、
whole 还是chunky monkey。那么，如果从一个集合中查询这三种类型的文档，
速度会很慢。但如果将这三种不同类型的文档拆分为三个不同的集合，每次只需
要查询相应的集合，速度快得多。

> + 把同种类型的文档放在一个集合里，数据会更加集中。从一个只包含博客文章的集合里查询几篇文章，或者从同时包含文章数据和作者数据的集合里查出几篇文章，相比之下，前者需要的磁盘寻道操作更少。

> + 创建索引时，需要使用文档的附加结构（特别是创建唯一索引时）。索引是按照集合来定义的。在一个集合中只放入一种类型的文档，可以更有效地对集合进行索引。

> 集合使用名称进行标识。集合名可以是满足下列条件的任意UTF-8 字符串。

> + 集合名不能是空字符串（""）。

> + 集合名不能包含\0 字符（空字符），这个字符表示集合名的结束。

> + 集合名不能以“system.”开头，这是为系统集合保留的前缀。例如，system.users这个集合保存着数据库的用户信息，而system.namespaces 集合保存着所有数据库集合的信息。

> + 用户创建的集合不能在集合名中包含保留字符'\$'。因为某些系统生成的集合中包含'\$'，很多驱动程序确实支持在集合名里包含该字符。除非你要访问这种系统创建的集合，否则不应该在集合名中包含'\$'。

> 子集合(在MongoDB 中，使用子集合来组织数据非常高效，值得推荐)

> + 组织集合的一种惯例是使用"."字符分开的按命名空间划分的子集合.如:一个带有博客功能的应用可能包含两个集合,分别是blog.posts和blog.authors.这样做的目的是为了使组织结构更好些,也就是说blog这个集合(可能根本就不存在)
及其子集合没有任何关系.很多MongoDB工具中都包含子集合

> + GridFS（一种用于存储大文件的协议）使用子集合来存储文件的元数据，这样就可以与文件内容块很好地隔离开来。

> + 大多数驱动程序都提供了一些语法糖，用于访问指定集合的子集合。例如，在数据库shell 中，db.blog 代表blog 集合，而db.blog.posts 代表blog.posts 集合。

- 数据库

> 在MongoDB 中，多个文档组成集合，而多个集合可以组成数据库。一个MongoDB
实例可以承载多个数据库，每个数据库拥有0 个或者多个集合。每个数据库都有
独立的权限，即便是在磁盘上，不同的数据库也放置在不同的文件中。按照经
验，我们将有关一个应用程序的所有数据都存储在同一个数据库中。要想在同一
个MongoDB 服务器上存放多个应用程序或者用户的数据，就需要使用不同的数
据库。

> 数据库通过名称来标识，这点与集合类似。数据库名可以是满足以下条件的任意UTF-8 字符串。

> + 不能是空字符串（""）。

> + 不得含有/、\、.、"、*、<、>、:、|、?、$（一个空格）、\0（空字符）。基本上，只能使用ASCII 中的字母和数字。

> + 数据库名区分大小写，即便是在不区分大小写的文件系统中也是如此。简单起见，数据库名应全部小写。

> + 数据库名最多为64 字节。

> **要记住一点，数据库最终会变成文件系统里的文件，而数据库名就是相应的文件名，这是数据库名有如此多限制的原因**

- 保留数据库

**在新版本>=2.6默认只有local**

> admin

> + 从身份验证的角度来讲，这是“root”数据库。如果将一个用户添加到admin 数据库，这个用户将自动获得所有数据库的权限。再者，一些特定的服务器端命令也只能从admin 数据库运行，如列出所有数据库或关闭服务器。

> local

> + 这个数据库永远都不可以复制，且一台服务器上的所有本地集合都可以存储在这个数据库中。

> config

> + MongoDB 用于分片设置时，分片信息会存储在config 数据库中。

> **把数据库名添加到集合名前，得到集合的完全限定名，即命名空间（namespace）。例如，如果要使用cms数据库中的blog.posts集合，这个集合的命名空间就是cms.blog.posts。命名空间的长度不得超过121字节，且在实际使用中应小于100字节**

**参考MongoDB权威指南**

  [1]: https://www.mongodb.org/